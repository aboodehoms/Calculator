<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scientific Calculator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Segoe UI', 'Inter', sans-serif;
            background-color: #f5f5f5; /* A neutral background to make the calculator pop */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 1rem;
            box-sizing: border-box;
        }
        .calculator-wrapper {
            background-color: #f0f0f0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            width: 100%;
            max-width: 620px; /* Adjusted to match image aspect ratio */
            box-sizing: border-box;
            border: 1px solid #a0a0a0;
            margin: 1rem auto; /* Added margin for centering and spacing */
        }
        .calculator-container {
            padding: 1rem;
        }
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-bottom: 0.75rem;
            border-bottom: 1px solid #a0a0a0;
            flex-wrap: wrap; /* Allow items to wrap on smaller screens */
            gap: 0.5rem; /* Gap between items when wrapped */
        }
        .mode-tabs {
            display: flex;
            flex-wrap: wrap; /* Allow tabs to wrap */
        }
        .mode-tab {
            padding: 0.4rem 0.8rem;
            cursor: pointer;
            color: #333;
            font-weight: 500;
            border: 1px solid #a0a0a0;
            background-color: #e1e1e1;
            margin-bottom: -1px; /* Pulls tab down to overlap the container border */
            border-bottom: 1px solid #a0a0a0;
        }
        .mode-tab.active {
            background-color: #f0f0f0; /* Active tab matches wrapper bg */
            border-bottom: none; /* Key change for blending effect */
        }
        .digit-grouping {
            background-color: #4472c4;
            color: #ffffff;
            padding: 0.5rem 1rem;
            border-radius: 0.1rem;
            font-weight: 500;
            cursor: pointer;
            border: 1px solid #3b63a9;
            white-space: nowrap; /* Prevent text wrapping */
        }
        .input-history {
            min-height: 1.25rem;
            font-size: 0.8rem;
            color: #666;
            text-align: right;
            margin-bottom: 0.25rem;
        }
        .display-area {
            background-color: #ffffff;
            border-radius: 0.1rem;
            padding: 0.5rem 0.75rem;
            text-align: right;
            font-size: 2.5rem; /* Base font size */
            font-weight: 600;
            margin-bottom: 0.75rem;
            overflow-x: auto;
            white-space: nowrap;
            color: #000;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            border: 1px solid #a0a0a0;
        }
        .button-grid {
            display: grid;
            gap: 0.25rem;
        }
        .button {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0.6rem 0.4rem;
            border-radius: 0.1rem;
            font-size: 1rem;
            font-weight: 400;
            cursor: pointer;
            user-select: none;
            min-height: 48px;
            border: 1px solid #a0a0a0;
            transition: filter 0.1s;
        }
        .button:active {
            filter: brightness(0.9);
        }
        /* Specific Button Colors and Styles - EXACT MATCHING */
        .button.digit {
            background-color: #fafafa;
            color: #000000;
            font-weight: 600; /* Bolder numbers */
        }
        .button.dot {
            background-color: #fafafa;
            color: #000000;
            font-weight: 600;
        }
        .button.operator {
            background-color: #92d050;
            color: #ffffff;
        }
        .button.clear, .button.back-btn, .button.ce {
            background-color: #d9534f;
            color: #ffffff;
        }
        .button.memory, .button.function {
            background-color: #e9e9e9;
            color: #000000;
        }
        .button.equals {
            background-color: #4472c4;
            color: #ffffff;
        }
        .button.copy {
            background-color: #e6e0b3;
            color: #000000;
            grid-column: span 11; /* Default for larger screens */
            margin-bottom: 0.25rem;
        }
        .radian-mode-buttons {
            display: flex;
            gap: 0.25rem;
            grid-column: span 3; /* Default for larger screens */
        }
        .radian-mode-button {
            flex: 1;
            padding: 0.4rem 0.6rem;
            cursor: pointer;
            background-color: #e9e9e9;
            color: #000000;
            font-weight: 400;
            text-align: center;
            border: 1px solid #a0a0a0;
            transition: filter 0.1s;
        }
        .radian-mode-button:active {
            filter: brightness(0.9);
        }
        .radian-mode-button.active {
            background-color: #cccccc; /* Correct grey for active state */
            border-color: #a0a0a0;
        }
        .hidden {
            display: none !important;
        }
        #scientific-button-grid {
            grid-template-columns: repeat(11, 1fr); /* Base for larger screens */
        }
        #scientific-button-grid .button.col-span-2 {
            grid-column: span 2; /* Base for larger screens */
        }
        /* Modal for alerts */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex; justify-content: center; align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: white; padding: 2rem; border-radius: 0.5rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            text-align: center; max-width: 90%;
        }
        .modal-buttons { margin-top: 1.5rem; }
        .modal-button {
            padding: 0.5rem 1.5rem; border-radius: 0.25rem; cursor: pointer;
            font-weight: bold; border: 1px solid #999; background-color: #eee;
        }

        /* --- Responsive Adjustments --- */

        /* Tablets and smaller desktops */
        @media (max-width: 768px) {
            .calculator-wrapper {
                max-width: 500px;
                padding: 0.75rem;
            }
            .calculator-container {
                padding: 0.75rem;
            }
            .display-area {
                font-size: 2rem; /* Slightly smaller on tablets */
                min-height: 45px;
            }
            .button {
                font-size: 0.9rem;
                min-height: 45px;
                padding: 0.5rem 0.3rem;
            }
            .mode-tab {
                padding: 0.3rem 0.6rem;
            }
            .digit-grouping {
                padding: 0.4rem 0.8rem;
                font-size: 0.9rem;
            }
            /* Adjust column spans if needed for a 9-column layout for example */
            #scientific-button-grid {
                grid-template-columns: repeat(9, 1fr); /* Adjust for more compact layout */
            }
            .button.copy {
                grid-column: span 9; /* Adjust copy button span */
            }
            .button.function[data-value="x^2"],
            .button.function[data-value="x^3"],
            .button.function[data-value="e"],
            .button.function[data-value="exp"],
            .button.function[data-value="ln"],
            .button.function[data-value="log"],
            .button.function[data-value="!"],
            .button.function[data-value="ex"],
            .button.function[data-value="("],
            .button.function[data-value=")"],
            .button.function[data-value="cos"],
            .button.function[data-value="cosh"],
            .button.function[data-value="tan"],
            .button.function[data-value="tanh"],
            .button.function[data-value="inv"],
            .button.function[data-value="sin"],
            .button.function[data-value="sinh"]
            {
                 /* These buttons now take 1 column in a 9-column grid */
                grid-column: span 1;
            }
            .button.col-span-2 {
                grid-column: span 2; /* Maintain for '0' in a new context */
            }
            .radian-mode-buttons {
                grid-column: span 3; /* Still span 3 of the 9 columns */
            }
        }

        /* Mobile devices */
        @media (max-width: 480px) {
            body {
                padding: 0.5rem;
            }
            .calculator-wrapper {
                max-width: 100%;
                margin: 0.5rem auto;
                padding: 0.5rem;
            }
            .calculator-container {
                padding: 0.5rem;
            }
            .display-area {
                font-size: 1.8rem; /* Even smaller for phones */
                min-height: 40px;
                padding: 0.4rem 0.6rem;
            }
            .input-history {
                font-size: 0.7rem;
            }
            .button {
                font-size: 0.85rem;
                min-height: 40px;
                padding: 0.4rem 0.2rem;
            }
            .mode-tab {
                padding: 0.25rem 0.5rem;
                font-size: 0.85rem;
            }
            .digit-grouping {
                padding: 0.3rem 0.6rem;
                font-size: 0.85rem;
            }
            #scientific-button-grid {
                grid-template-columns: repeat(7, 1fr); /* More compact for very small screens */
            }
            .button.copy {
                grid-column: span 7; /* Adjust copy button span */
            }
            .button.col-span-2 {
                grid-column: span 2; /* Adjust '0' button for 7 columns */
            }
            .radian-mode-buttons {
                grid-column: span 3; /* Adjust radian buttons for 7 columns, might need further refinement for a better fit */
            }
             /* Further adjustments for buttons to ensure visibility and touchability */
            .button.function,
            .button.memory,
            .button.operator,
            .button.clear,
            .button.back-btn,
            .button.ce,
            .button.digit,
            .button.dot,
            .button.equals {
                grid-column: span 1; /* All single-column buttons take 1 span */
            }
        }
    </style>
</head>
<body>
    <div class="calculator-wrapper">
        <div class="calculator-container">
            <div class="top-bar">
                <div class="mode-tabs">
                    <div class="mode-tab" id="basic-tab">Basic</div>
                    <div class="mode-tab active" id="scientific-tab">Scientific</div>
                </div>
                <div class="digit-grouping">Digit Grouping</div>
            </div>

            <div class="input-history" id="input-history"></div>
            <div class="display-area" id="display">0</div>
            
            <div id="button-grids-container">
                <div id="basic-button-grid" class="button-grid hidden"></div>

                <div id="scientific-button-grid" class="button-grid">
                    <div class="button copy" id="copy-button">Copy</div>

                    <div class="button function" data-value="1/x">¹/ₓ</div>
                    <div class="button memory" data-value="pm">±</div>
                    <div class="button memory" data-value="mc">MC</div>
                    <div class="button memory" data-value="mr">MR</div>
                    <div class="button memory" data-value="ms">MS</div>
                    <div class="button memory" data-value="m+">M+</div>
                    <div class="button memory" data-value="m-">M-</div>
                    <div class="button clear" data-value="c">C</div>
                    <div class="button back-btn" data-value="back">Back</div>
                    <div class="button ce" data-value="ce">CE</div>
                    <div class="button operator" data-value="%">%</div>

                    <div class="button function" data-value="sqrt">√</div>
                    <div class="button function" data-value="cbrt">∛</div>
                    <div class="button function" data-value="x^2">x²</div>
                    <div class="button function" data-value="x^3">x³</div>
                    <div class="button function" data-value="x^y">xʸ</div>
                    <div class="button function" data-value="e">e</div>
                    <div class="button digit" data-value="7">7</div>
                    <div class="button digit" data-value="8">8</div>
                    <div class="button digit" data-value="9">9</div>
                    <div class="button operator" data-value="/">÷</div>

                    <div class="button function" data-value="pi">π</div>
                    <div class="button function" data-value="exp">Exp</div>
                    <div class="button function" data-value="ln">ln</div>
                    <div class="button function" data-value="log">log</div>
                    <div class="button function" data-value="!">n!</div>
                    <div class="button function" data-value="ex">eˣ</div>
                    <div class="button digit" data-value="4">4</div>
                    <div class="button digit" data-value="5">5</div>
                    <div class="button digit" data-value="6">6</div>
                    <div class="button operator" data-value="*">×</div>

                    <div class="button function" data-value="(">(</div>
                    <div class="button function" data-value=")">)</div>
                    <div class="button function" data-value="cos">cos</div>
                    <div class="button function" data-value="cosh">cosh</div>
                    <div class="button function" data-value="tan">tan</div>
                    <div class="button function" data-value="tanh">tanh</div>
                    <div class="button digit" data-value="1">1</div>
                    <div class="button digit" data-value="2">2</div>
                    <div class="button digit" data-value="3">3</div>
                    <div class="button operator" data-value="-">-</div>

                    <div class="radian-mode-buttons">
                        <div class="radian-mode-button active" data-mode="deg">Deg</div>
                        <div class="radian-mode-button" data-mode="rad">Rad</div>
                        <div class="radian-mode-button" data-mode="grad">Grad</div>
                    </div>
                    <div class="button function" data-value="inv">Inv</div>
                    <div class="button function" data-value="sin">sin</div>
                    <div class="button function" data-value="sinh">sinh</div>
                    <div class="button col-span-2 digit" data-value="0">0</div>
                    <div class="button dot" data-value=".">.</div>
                    <div class="button equals" data-value="=">=</div>
                    <div class="button operator" data-value="+">+</div>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-overlay" class="modal-overlay hidden">
        <div class="modal-content">
            <p id="modal-message"></p>
            <div class="modal-buttons">
                 <button id="modal-confirm" class="modal-button">OK</button>
            </div>
        </div>
    </div>


    <script>
        // DOM Elements
        const display = document.getElementById('display');
        const inputHistory = document.getElementById('input-history');
        const basicButtonGrid = document.getElementById('basic-button-grid');
        const scientificButtonGrid = document.getElementById('scientific-button-grid');
        const basicTab = document.getElementById('basic-tab');
        const scientificTab = document.getElementById('scientific-tab');
        const radianModeButtons = document.querySelectorAll('.radian-mode-button');
        const digitGroupingButton = document.querySelector('.digit-grouping');
        const buttonGridsContainer = document.getElementById('button-grids-container');

        // Modal elements
        const modalOverlay = document.getElementById('modal-overlay');
        const modalMessage = document.getElementById('modal-message');
        const modalConfirmBtn = document.getElementById('modal-confirm');

        // Calculator State Variables
        let currentInput = '0';
        let previousInput = '';
        let operator = null;
        let equalsPressed = false;
        let memory = 0;
        let angleMode = 'deg'; // 'deg', 'rad', 'grad'
        let digitGroupingEnabled = false;

        // Function to display custom modal
        function showModal(message) {
            modalMessage.textContent = message;
            modalOverlay.classList.remove('hidden');
            modalConfirmBtn.onclick = () => {
                modalOverlay.classList.add('hidden');
            };
        }

        function updateDisplay() {
            let displayedValue = currentInput;
            if (digitGroupingEnabled) {
                const parts = currentInput.split('.');
                parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                displayedValue = parts.join('.');
            }
            display.textContent = displayedValue;
            let historyOperator = operator ? ` ${operator.replace('*', '×').replace('/', '÷').replace('x^y','^')}` : '';
            inputHistory.textContent = previousInput + historyOperator;
        }

        function toggleDigitGrouping() {
            digitGroupingEnabled = !digitGroupingEnabled;
            digitGroupingButton.style.filter = digitGroupingEnabled ? 'brightness(0.9)' : 'brightness(1)';
            updateDisplay();
        }

        function removeGrouping(numberString) {
            return String(numberString).replace(/,/g, '');
        }

        function calculate() {
            let result;
            let prev = parseFloat(removeGrouping(previousInput));
            let current = parseFloat(removeGrouping(currentInput));
            if (isNaN(prev) || isNaN(current)) return;
            
            if (operator === '%') {
                 result = prev * (current / 100);
            } else {
                switch (operator) {
                    case '+': result = prev + current; break;
                    case '-': result = prev - current; break;
                    case '*': result = prev * current; break;
                    case '/':
                        if (current === 0) { showModal('Cannot divide by zero!'); clearAll(); return; }
                        result = prev / current; break;
                    case 'x^y': result = Math.pow(prev, current); break;
                    default: return;
                }
            }
            currentInput = String(result);
            operator = null;
            equalsPressed = true;
            updateDisplay();
            previousInput = ''; // Clear history after calculation
        }

        function clearAll() {
            currentInput = '0';
            previousInput = '';
            operator = null;
            equalsPressed = false;
            updateDisplay();
        }

        function clearEntry() {
            currentInput = '0';
            equalsPressed = false;
            updateDisplay();
        }

        function backspace() {
            if (equalsPressed) { clearAll(); return; }
            currentInput = removeGrouping(currentInput).slice(0, -1);
            if (currentInput === '' || currentInput === '-') {
                currentInput = '0';
            }
            updateDisplay();
        }

        function handleFunction(func) {
            let val = parseFloat(removeGrouping(currentInput));
            if (isNaN(val) && !['pi', 'e'].includes(func)) { showModal('Invalid input for function!'); return; }
            let result;
            switch (func) {
                case '1/x': result = 1 / val; break;
                case 'sqrt': result = Math.sqrt(val); break;
                case 'cbrt': result = Math.cbrt(val); break;
                case 'x^2': result = val * val; break;
                case 'x^3': result = val * val * val; break;
                case 'pi': result = Math.PI; break;
                case 'exp': result = Math.exp(val); break;
                case 'ln': result = Math.log(val); break;
                case 'log': result = Math.log10(val); break;
                case '!':
                    if (val < 0 || !Number.isInteger(val)) { showModal('Factorial is for non-negative integers only.'); return; }
                    result = factorial(val); break;
                case 'ex': result = Math.exp(val); break;
                case 'e': result = Math.E; break;
                case 'sin': result = Math.sin(convertAngle(val)); break;
                case 'cos': result = Math.cos(convertAngle(val)); break;
                case 'tan': result = Math.tan(convertAngle(val)); break;
                case 'sinh': result = Math.sinh(val); break;
                case 'cosh': result = Math.cosh(val); break;
                case 'tanh': result = Math.tanh(val); break;
                case 'inv': showModal('Inverse function not implemented.'); return;
                default: return;
            }
            currentInput = String(result);
            equalsPressed = true;
            updateDisplay();
        }
        
        function handleOperator(op) {
             if (operator && previousInput !== '' && !equalsPressed) calculate();
             previousInput = removeGrouping(currentInput);
             operator = op;
             equalsPressed = true; // Set to true to allow new number input
             updateDisplay();
        }

        function convertAngle(value) {
            if (angleMode === 'deg') return value * (Math.PI / 180);
            if (angleMode === 'grad') return value * (Math.PI / 200);
            return value; // Radian
        }

        function factorial(n) {
            if (n > 170) return Infinity;
            if (n === 0 || n === 1) return 1;
            let res = 1;
            for (let i = n; i > 1; i--) res *= i;
            return res;
        }

        function handleMemory(memFunc) {
            let currentValue = parseFloat(removeGrouping(currentInput));
            switch (memFunc) {
                case 'mc': memory = 0; showModal('Memory Cleared.'); break;
                case 'mr': currentInput = String(memory); equalsPressed = true; break;
                case 'ms': memory = currentValue; showModal('Value Stored in Memory.'); break;
                case 'm+': memory += currentValue; showModal('Value Added to Memory.'); break;
                case 'm-': memory -= currentValue; showModal('Value Subtracted from Memory.'); break;
                case 'pm': currentInput = String(currentValue * -1); break;
            }
            updateDisplay();
        }
        
        buttonGridsContainer.addEventListener('click', (event) => {
            const button = event.target.closest('.button, .radian-mode-button');
            if (!button) return;

            const value = button.dataset.value;
            const classList = button.classList;

            if (classList.contains('digit')) {
                if (equalsPressed || currentInput === '0') {
                    currentInput = value;
                    equalsPressed = false;
                } else {
                    currentInput += value;
                }
            } else if (classList.contains('dot')) {
                 if (equalsPressed) { currentInput = '0.'; equalsPressed = false; }
                 else if (!currentInput.includes('.')) currentInput += '.';
            } else if (classList.contains('operator') || value === 'x^y') {
                handleOperator(value);
            } else if (classList.contains('equals')) {
                if (operator && previousInput !== '') calculate();
            } else if (value === 'c') {
                clearAll();
            } else if (value === 'ce') {
                clearEntry();
            } else if (value === 'back') {
                backspace();
            } else if (classList.contains('function')) {
                handleFunction(value);
            } else if (classList.contains('memory')) {
                handleMemory(value);
            } else if (classList.contains('radian-mode-button')) {
                 radianModeButtons.forEach(btn => btn.classList.remove('active'));
                 button.classList.add('active');
                 angleMode = button.dataset.mode;
            }
            updateDisplay();
        });

        document.getElementById('copy-button').addEventListener('click', () => {
             navigator.clipboard.writeText(display.textContent).then(() => {
                showModal('Copied to clipboard!');
            }, () => {
                showModal('Failed to copy.');
            });
        });
        
        digitGroupingButton.addEventListener('click', toggleDigitGrouping);
        updateDisplay(); // Initial call
    </script>
</body>
</html>
```
