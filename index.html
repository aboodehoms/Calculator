<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scientific & Basic Calculator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Basic Setup */
        body {
            font-family: 'Segoe UI', 'Inter', sans-serif;
            background-color: #e3e3e3;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 1rem;
            box-sizing: border-box;
        }

        /* Calculator Wrapper */
        .calculator-wrapper {
            background-color: #f0f0f0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 700px; /* Accommodates the wider scientific layout */
            box-sizing: border-box;
            border: 1px solid #a0a0a0;
        }

        /* Adjust wrapper for basic mode */
        .calculator-wrapper.basic-mode {
            max-width: 400px; /* Narrower for the basic layout */
        }

        .calculator-container {
            padding: 0.75rem;
        }

        /* Top Bar */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-bottom: 0.75rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid #a0a0a0;
        }

        .mode-tabs { display: flex; }

        .mode-tab {
            padding: 0.4rem 0.8rem; cursor: pointer; color: #333;
            font-weight: 500; border: 1px solid #a0a0a0;
            background-color: #e1e1e1; margin-right: -1px;
        }

        .mode-tab.active {
            background-color: #f0f0f0;
            border-bottom: none;
        }

        .digit-grouping {
            background-color: #4472c4; color: #ffffff; padding: 0.5rem 1rem;
            font-weight: 600; cursor: pointer; border: 1px solid #3b63a9;
        }
        .digit-grouping:active { filter: brightness(0.9); }

        /* Display Area */
        .input-history {
            min-height: 1.25rem; font-size: 0.8rem; color: #666; text-align: right;
            margin-bottom: 0.25rem; padding-right: 0.5rem;
        }

        .display-area {
            background-color: #ffffff; padding: 0.5rem 0.75rem;
            text-align: right; font-size: 2.8rem; font-weight: 600;
            margin-bottom: 0.75rem; overflow-x: auto; white-space: nowrap;
            color: #000; min-height: 60px;
            display: flex; align-items: center; justify-content: flex-end;
            border: 1px solid #a0a0a0;
        }

        /* --- Button Grids --- */
        #scientific-button-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 0.3rem;
        }
        
        #basic-button-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.3rem;
        }
        
        #basic-button-grid .button.back-btn {
            background-color: #cc0000;
            color: #ffffff;
        }


        .button {
            display: flex; justify-content: center; align-items: center;
            padding: 0.5rem; font-size: 1rem; cursor: pointer;
            user-select: none; min-height: 48px; border: 1px solid #a0a0a0;
            transition: filter 0.1s;
        }

        .button:active { filter: brightness(0.9); }
        
        /* Grid Column Spans */
        .col-span-9 { grid-column: span 9; }

        /* Button Colors and Styles */
        .button.digit { background-color: #fafafa; color: #000000; font-weight: 700; }
        .button.dot { background-color: #fafafa; color: #000000; }
        .button.operator { background-color: #38761d; color: #ffffff; }
        .button.clear, .button.ce { background-color: #cc0000; color: #ffffff; }
        .button.memory, .button.function { background-color: #e9e9e9; color: #000000; }
        .button.equals { background-color: #4a86e8; color: #ffffff; }
        .button.copy { background-color: #e6e0b3; color: #000000; margin-bottom: 0.3rem; }
        
        .first-row-wrapper {
            grid-column: span 10;
            display: flex;
            gap: 0.3rem;
            margin-bottom: 0.3rem;
        }
        .first-row-wrapper .copy { flex: 9; margin-bottom: 0;} /* Copy takes 9 units */
        .first-row-wrapper .function { flex: 1; margin-bottom: 0;} /* 1/x takes 1 unit */
        
        .last-row-wrapper {
            grid-column: span 10;
            display: flex;
            gap: 0.3rem;
        }
        .last-row-wrapper .button { flex: 1 1 0; }
        .last-row-wrapper .digit { flex-grow: 2; }

        .radian-mode-buttons { display: flex; flex: 3 1 0; }
        .radian-mode-button {
            flex: 1; padding: 0.4rem 0.6rem; cursor: pointer;
            background-color: #e9e9e9; color: #000000;
            font-weight: 400; text-align: center; border: 1px solid #a0a0a0;
            transition: background-color 0.1s;
        }
        .radian-mode-button.active { background-color: #cccccc; }
        .radian-mode-button:active { filter: brightness(0.9); }
        .radian-mode-button:not(:last-child) { border-right: none; }


        .hidden { display: none !important; }

        /* Modal for Alerts */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.5); display: flex;
            justify-content: center; align-items: center; z-index: 1000;
        }
        .modal-content {
            background: white; padding: 2rem; border-radius: 0.25rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); text-align: center; max-width: 90%;
        }
        .modal-buttons { margin-top: 1.5rem; }
        .modal-button {
            padding: 0.5rem 1.5rem; border-radius: 0.25rem; cursor: pointer;
            font-weight: bold; border: none; background-color: #4472c4; color: white;
        }
    </style>
</head>
<body>
    <div class="calculator-wrapper" id="calculator-wrapper">
        <div class="calculator-container">
            <div class="top-bar">
                <div class="mode-tabs">
                    <div class="mode-tab" id="basic-tab">Basic</div>
                    <div class="mode-tab active" id="scientific-tab">Scientific</div>
                </div>
                <div class="digit-grouping">Digit Grouping</div>
            </div>

            <div class="input-history" id="input-history"></div>
            <div class="display-area" id="display">0</div>
            
            <div id="button-grids-container">
                <!-- Scientific Grid -->
                <div id="scientific-button-grid" class="button-grid">
                    <div class="first-row-wrapper">
                        <div class="button function" data-value="1/x">¹/ₓ</div>
                        <div class="button copy" id="copy-button">Copy</div>
                    </div>
                    <div class="button memory" data-value="pm">±</div>
                    <div class="button memory" data-value="mc">MC</div>
                    <div class="button memory" data-value="mr">MR</div>
                    <div class="button memory" data-value="ms">MS</div>
                    <div class="button memory" data-value="m+">M+</div>
                    <div class="button memory" data-value="m-">M-</div>
                    <div class="button clear" data-value="c">C</div>
                    <div class="button back-btn" data-value="back">Back</div>
                    <div class="button ce" data-value="ce">CE</div>
                    <div class="button operator" data-value="%">%</div>
                    <div class="button function" data-value="sqrt">√</div>
                    <div class="button function" data-value="cbrt">∛</div>
                    <div class="button function" data-value="x^2">x²</div>
                    <div class="button function" data-value="x^3">x³</div>
                    <div class="button function" data-value="x^y">xʸ</div>
                    <div class="button function" data-value="e">e</div>
                    <div class="button digit" data-value="7">7</div>
                    <div class="button digit" data-value="8">8</div>
                    <div class="button digit" data-value="9">9</div>
                    <div class="button operator" data-value="/">÷</div>
                    <div class="button function" data-value="pi">π</div>
                    <div class="button function" data-value="exp">Exp</div>
                    <div class="button function" data-value="ln">ln</div>
                    <div class="button function" data-value="log">log</div>
                    <div class="button function" data-value="!">n!</div>
                    <div class="button function" data-value="ex">eˣ</div>
                    <div class="button digit" data-value="4">4</div>
                    <div class="button digit" data-value="5">5</div>
                    <div class="button digit" data-value="6">6</div>
                    <div class="button operator" data-value="*">×</div>
                    <div class="button function" data-value="(">(</div>
                    <div class="button function" data-value=")">)</div>
                    <div class="button function" data-value="cos">cos</div>
                    <div class="button function" data-value="cosh">cosh</div>
                    <div class="button function" data-value="tan">tan</div>
                    <div class="button function" data-value="tanh">tanh</div>
                    <div class="button digit" data-value="1">1</div>
                    <div class="button digit" data-value="2">2</div>
                    <div class="button digit" data-value="3">3</div>
                    <div class="button operator" data-value="-">-</div>
                    <div class="last-row-wrapper">
                        <div class="radian-mode-buttons">
                            <div class="radian-mode-button active" data-mode="deg">Deg</div>
                            <div class="radian-mode-button" data-mode="rad">Rad</div>
                            <div class="radian-mode-button" data-mode="grad">Grad</div>
                        </div>
                        <div class="button function" data-value="inv">Inv</div>
                        <div class="button function" data-value="sin">sin</div>
                        <div class="button function" data-value="sinh">sinh</div>
                        <div class="button digit" data-value="0">0</div>
                        <div class="button dot" data-value=".">.</div>
                        <div class="button equals" data-value="=">=</div>
                        <div class="button operator" data-value="+">+</div>
                    </div>
                </div>

                <!-- Basic Grid -->
                <div id="basic-button-grid" class="button-grid hidden">
                    <div class="button memory" data-value="mc">MC</div>
                    <div class="button clear" data-value="c">C</div>
                    <div class="button back-btn" data-value="back">Backspace</div>
                    <div class="button ce" data-value="ce">CE</div>
                    <div class="button memory" data-value="mr">MR</div>
                    <div class="button function" data-value="sqrt">√</div>
                    <div class="button digit" data-value="7">7</div>
                    <div class="button digit" data-value="8">8</div>
                    <div class="button memory" data-value="ms">MS</div>
                    <div class="button memory" data-value="pm">±</div>
                    <div class="button digit" data-value="4">4</div>
                    <div class="button digit" data-value="5">5</div>
                    <div class="button memory" data-value="m+">M+</div>
                    <div class="button function" data-value="1/x">¹/ₓ</div>
                    <div class="button digit" data-value="1">1</div>
                    <div class="button digit" data-value="2">2</div>
                    <div class="button memory" data-value="m-">M-</div>
                    <div class="button operator" data-value="%">%</div>
                    <div class="button digit" data-value="0">0</div>
                    <div class="button dot" data-value=".">.</div>
                    
                    <!-- Operators for Basic -->
                    <div class="button digit" data-value="9">9</div>
                    <div class="button operator" data-value="/">÷</div>
                    <div class="button digit" data-value="6">6</div>
                    <div class="button operator" data-value="*">×</div>
                    <div class="button digit" data-value="3">3</div>
                    <div class="button operator" data-value="-">-</div>
                    <div class="button equals" data-value="=">=</div>
                    <div class="button operator" data-value="+">+</div>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-overlay" class="modal-overlay hidden">
        <div class="modal-content">
            <p id="modal-message"></p>
            <div class="modal-buttons">
                 <button id="modal-confirm" class="modal-button">OK</button>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const calculatorWrapper = document.getElementById('calculator-wrapper');
        const display = document.getElementById('display');
        const inputHistory = document.getElementById('input-history');
        const scientificButtonGrid = document.getElementById('scientific-button-grid');
        const basicButtonGrid = document.getElementById('basic-button-grid');
        const buttonGridsContainer = document.getElementById('button-grids-container');
        const basicTab = document.getElementById('basic-tab');
        const scientificTab = document.getElementById('scientific-tab');
        const digitGroupingButton = document.querySelector('.digit-grouping');
        const modalOverlay = document.getElementById('modal-overlay');
        const modalMessage = document.getElementById('modal-message');
        const modalConfirmBtn = document.getElementById('modal-confirm');

        // Calculator State
        let currentInput = '0';
        let previousInput = '';
        let operator = null;
        let equalsPressed = false;
        let memory = 0;
        let angleMode = 'deg';
        let digitGroupingEnabled = false;

        // --- Core Functions ---
        function showModal(message) {
            modalMessage.textContent = message;
            modalOverlay.classList.remove('hidden');
            modalConfirmBtn.onclick = () => modalOverlay.classList.add('hidden');
        }

        function updateDisplay() {
            let displayedValue = currentInput;
            if (digitGroupingEnabled && !currentInput.includes('e')) {
                const parts = currentInput.split('.');
                parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                displayedValue = parts.join('.');
            }
            display.textContent = displayedValue;
            let historyOperator = operator ? ` ${operator.replace('*', '×').replace('/', '÷').replace('x^y','^')}` : '';
            inputHistory.textContent = previousInput + historyOperator;
        }

        function toggleDigitGrouping() {
            digitGroupingEnabled = !digitGroupingEnabled;
            digitGroupingButton.style.filter = digitGroupingEnabled ? 'brightness(0.9)' : 'brightness(1)';
            updateDisplay();
        }

        function removeGrouping(numberString) {
            return String(numberString).replace(/,/g, '');
        }

        function calculate() {
            let result;
            let prev = parseFloat(removeGrouping(previousInput));
            let current = parseFloat(removeGrouping(currentInput));
            if (isNaN(prev) || isNaN(current)) return;
            
            if (operator === '%') {
                 result = prev * (current / 100);
            } else {
                switch (operator) {
                    case '+': result = prev + current; break;
                    case '-': result = prev - current; break;
                    case '*': result = prev * current; break;
                    case '/':
                        if (current === 0) { showModal('Cannot divide by zero'); clearAll(); return; }
                        result = prev / current; break;
                    case 'x^y': result = Math.pow(prev, current); break;
                    default: return;
                }
            }
            currentInput = String(result);
            operator = null;
            equalsPressed = true;
            updateDisplay();
            previousInput = '';
        }

        function clearAll() {
            currentInput = '0';
            previousInput = '';
            operator = null;
            equalsPressed = false;
            updateDisplay();
        }

        function clearEntry() {
            currentInput = '0';
            equalsPressed = false;
            updateDisplay();
        }

        function backspace() {
            if (equalsPressed) { clearAll(); return; }
            currentInput = removeGrouping(currentInput).slice(0, -1);
            if (currentInput === '' || currentInput === '-') {
                currentInput = '0';
            }
            updateDisplay();
        }

        function handleFunction(func) {
            let val = parseFloat(removeGrouping(currentInput));
            if (isNaN(val) && !['pi', 'e'].includes(func)) { showModal('Invalid input for function'); return; }
            let result;
            switch (func) {
                case '1/x': result = 1 / val; break;
                case 'sqrt': result = Math.sqrt(val); break;
                case 'cbrt': result = Math.cbrt(val); break;
                case 'x^2': result = val * val; break;
                case 'x^3': result = val * val * val; break;
                case 'pi': result = Math.PI; break;
                case 'exp': result = Math.exp(val); break;
                case 'ln': result = Math.log(val); break;
                case 'log': result = Math.log10(val); break;
                case '!':
                    if (val < 0 || !Number.isInteger(val)) { showModal('Factorial is for non-negative integers only.'); return; }
                    result = factorial(val); break;
                case 'ex': result = Math.exp(val); break;
                case 'e': result = Math.E; break;
                case 'sin': result = Math.sin(convertAngle(val)); break;
                case 'cos': result = Math.cos(convertAngle(val)); break;
                case 'tan': result = Math.tan(convertAngle(val)); break;
                case 'sinh': result = Math.sinh(val); break;
                case 'cosh': result = Math.cosh(val); break;
                case 'tanh': result = Math.tanh(val); break;
                case 'inv': showModal('Inverse function not implemented.'); return;
                default: return;
            }
            currentInput = String(result);
            equalsPressed = true;
            updateDisplay();
        }
        
        function handleOperator(op) {
             if (operator && previousInput !== '' && !equalsPressed) {
                calculate();
             }
             previousInput = removeGrouping(currentInput);
             operator = op;
             currentInput = '0';
             equalsPressed = false;
             updateDisplay();
        }

        function convertAngle(value) {
            if (angleMode === 'deg') return value * (Math.PI / 180);
            if (angleMode === 'grad') return value * (Math.PI / 200);
            return value;
        }

        function factorial(n) {
            if (n > 170) return Infinity;
            if (n === 0 || n === 1) return 1;
            let res = 1;
            for (let i = n; i > 1; i--) res *= i;
            return res;
        }
        
        function handleMemory(memFunc) {
            let currentValue = parseFloat(removeGrouping(currentInput));
            switch (memFunc) {
                case 'mc': memory = 0; showModal('Memory Cleared.'); break;
                case 'mr': currentInput = String(memory); equalsPressed = true; break;
                case 'ms': if(!isNaN(currentValue)) { memory = currentValue; showModal('Value Stored in Memory.'); } break;
                case 'm+': memory += currentValue; showModal('Value Added to Memory.'); break;
                case 'm-': memory -= currentValue; showModal('Value Subtracted from Memory.'); break;
                case 'pm': currentInput = String(currentValue * -1); break;
            }
            updateDisplay();
        }
        
        // --- Event Listeners ---
        buttonGridsContainer.addEventListener('click', (event) => {
            const button = event.target.closest('.button, .radian-mode-button');
            if (!button) return;

            const value = button.dataset.value;
            const classList = button.classList;
            
            if (classList.contains('radian-mode-button')) {
                document.querySelectorAll('.radian-mode-button').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                angleMode = button.dataset.mode;
                return;
            }

            if (classList.contains('digit')) {
                if (equalsPressed || currentInput === '0') {
                    currentInput = value;
                    equalsPressed = false;
                } else {
                    currentInput += value;
                }
            } else if (classList.contains('dot')) {
                 if (equalsPressed) { currentInput = '0.'; equalsPressed = false; }
                 else if (!currentInput.includes('.')) currentInput += '.';
            } else if (classList.contains('operator') || value === 'x^y') {
                handleOperator(value);
            } else if (classList.contains('equals')) {
                if (operator && previousInput !== '') calculate();
            } else if (value === 'c') {
                clearAll();
            } else if (value === 'ce') {
                clearEntry();
            } else if (value === 'back') {
                backspace();
            } else if (classList.contains('function')) {
                if (value === '(' || value === ')') {
                    showModal('Parentheses are not yet implemented.');
                } else {
                    handleFunction(value);
                }
            } else if (classList.contains('memory')) {
                handleMemory(value);
            } 
            updateDisplay();
        });

        document.getElementById('copy-button').addEventListener('click', () => {
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(display.textContent).then(() => {
                    showModal('Copied to clipboard!');
                }, () => { showModal('Failed to copy.'); });
            } else {
                const textArea = document.createElement('textarea');
                textArea.value = display.textContent;
                document.body.appendChild(textArea);
                textArea.select();
                try { document.execCommand('copy'); showModal('Copied to clipboard!'); } 
                catch (err) { showModal('Failed to copy.'); }
                document.body.removeChild(textArea);
            }
        });
        
        digitGroupingButton.addEventListener('click', toggleDigitGrouping);

        // Tab Switching Logic
        basicTab.addEventListener('click', () => {
            scientificTab.classList.remove('active');
            basicTab.classList.add('active');
            scientificButtonGrid.classList.add('hidden');
            basicButtonGrid.classList.remove('hidden');
            calculatorWrapper.classList.add('basic-mode');
        });

        scientificTab.addEventListener('click', () => {
            basicTab.classList.remove('active');
            scientificTab.classList.add('active');
            basicButtonGrid.classList.add('hidden');
            scientificButtonGrid.classList.remove('hidden');
            calculatorWrapper.classList.remove('basic-mode');
        });
        
        updateDisplay();
    </script>
</body>
</html>
